version: '3'

services:
  # 1. 백엔드 (DB, Redis, Gotrue와도 통신하고 MinIO와도 통신해야 함)
  appflowy_cloud:
    networks:
      - default        # AppFlowy 내부 통신용 (필수)
      - minio_network  # MinIO 통신용 (추가)

  # 2. 내부 Nginx (프록시가 MinIO로 트래픽을 넘겨야 함)
  nginx:
    networks:
      - default
      - minio_network

  # 3. 워커 (데이터 Import/Export 시 MinIO 접근)
  appflowy_worker:
    networks:
      - default
      - minio_network

  # 4. AI 서비스 (파일 읽기)
  ai:
    networks:
      - default
      - minio_network

# 최하단에 외부 네트워크 정의
networks:
  minio_network:
    external: true
    name: minio_network # 사용자님의 minio docker-compose에 정의된 네트워크 이름